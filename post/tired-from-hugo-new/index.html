<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>hugo new で記事を新規作成すると少しダルいから自作スクリプトで編集する | tbsmcd.net</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/scss/code.min.daf683076712a8fd05c112ad6575fb841b4d15640f4c87e71541744189b69260.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/scss/custom.min.8ed8d5774a78420bb33b7e56b48fb76ad0d3f9df9ed410c3e99b2648e8f27500.css><script src=/js/theme.js defer></script><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/tired-from-hugo-new/"><meta property="og:title" content="hugo new で記事を新規作成すると少しダルいから自作スクリプトで編集する | tbsmcd"><meta property="og:description" content="hugo new で記事を新規作成するのは少しダルいので Pyhton で対話的に記事を作成できるスクリプトを書いて使用している。プログラム間を Markdown でやり取りするのは UNIX 的だと思う。"><meta name=description content="hugo new で記事を新規作成するのは少しダルいので Pyhton で対話的に記事を作成できるスクリプトを書いて使用している。プログラム間を Markdown でやり取りするのは UNIX 的だと思う。"><meta property="og:image" content="https://tbsmcd.net/post/tired-from-hugo-new/program.png"></head><body><header>tbsmcd.net <a href=/><span>index</span></a>, <a href=/archives/><span>archives</span></a>, <a href=/tags/><span>tags</span></a>, <a href=/search/><span>search</span></a>, <a href=/profile/><span>profile</span></a> <input type=checkbox id=cb-dark-theme> Dark theme</header><main><h1 class=h1-mono-post><span>hugo new で記事を新規作成すると少しダルいから自作スクリプトで編集する</span></h1><p class=article-date>2020-07-09 22:49:20 +0900</p><h2 id=hugo-new->hugo new のダルさ</h2><p>　hugo で新規記事を作るときはコマンドラインで<code>hugo new</code> を打つ。たとえば http://ドメイン/sample-article という記事を作りたい場合、</p><ol><li><code>hugo new post/sample-article/index.md</code> を実行する<ul><li><code>./contetn/post/sample-article/index.md</code> が作成される</li></ul></li><li>エディタで作成された index.md を開き記事を書く</li><li>画像を <code>./content/post/sample-article/</code> 以下に配置する</li></ol><p>たったこれだけを実行すればよいのだが、やってみると案外ダルい。自分としてはダルさが明確で</p><ul><li><code>hugo new post/dir-name/index.md</code> なのか <code>hugo new content/post/dir-name/index.md</code> なのか <code>hugo new posts/dir-name/index.md</code> なのか分からなくなる</li><li><code>hugo new コマンドでは </code>post/dir-name/index.md<code>を指定したのにエディタでは</code>content/post/dir-name/index.md` を指定して開かないといけない</li><li>画像を載せたい場合はほぼ同じ path である <code>content/post/dir-name/</code> を開いて画像を配置しなければならない</li></ul><p>というふうに、重複がダルい。これはプログラマの美徳でいう「怠惰」精神の発露といえよう（ダルいと怠惰はほとんど同じ言葉なのだけど）。</p><p>　index.md の雛形は <code>archetypes/default.md</code> に書いておけば反映されるのでさほど面倒ではない。例えばこのブログの場合は以下のようになっている。</p><pre><code>---
title: &quot;&quot;
description: &quot;&quot;
image: &quot;&quot;
date: {{ .Date }}
tags: []
archives: [&quot;{{ dateFormat &quot;2006-01&quot; .Date }}&quot;]
draft: true
---
</code></pre><p>date や archives の部分の日付は勝手に補完されるし、ふつうに考えればとても便利！しかしこれを編集する手間も省きたいのが人情というもの。そこで最近は Pyhton スクリプトを書いて、対話的に記事を作っている。</p><h2 id=python->Python スクリプト</h2><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=ch>#!/usr/bin/env python3</span>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>datetime</span>
<span class=kn>from</span> <span class=nn>subprocess</span> <span class=kn>import</span> <span class=n>run</span>


<span class=k>def</span> <span class=nf>input_dir_name</span><span class=p>(</span><span class=p>)</span><span class=p>:</span>
    <span class=n>name</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Directory name: </span><span class=s1>&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>_</span><span class=s1>&#39;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>-</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=k>print</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
    <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span> <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>/content/post/{0}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=p>:</span>
        <span class=n>edit</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>This dir_name exists. Edit this page?(Y/n) : </span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>edit</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>y</span><span class=s1>&#39;</span> <span class=ow>or</span> <span class=n>edit</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>Y</span><span class=s1>&#39;</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>name</span><span class=p>,</span> <span class=bp>False</span>
        <span class=k>print</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Please use other name.</span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=n>input_dir_name</span><span class=p>(</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>name</span><span class=p>,</span> <span class=bp>True</span>


<span class=k>try</span><span class=p>:</span>
    <span class=n>dir_name</span><span class=p>,</span> <span class=n>is_new</span> <span class=o>=</span> <span class=n>input_dir_name</span><span class=p>(</span><span class=p>)</span>
    <span class=n>dir_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span> <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>/content/post/{0}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dir_name</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>is_new</span> <span class=ow>is</span> <span class=bp>True</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Create new page.</span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=n>title</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Title: </span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=n>desc</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Description: </span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=n>img</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>OGP image: </span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=n>tags</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Tags(comma separated): </span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=n>draft</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Draft(Y/n): </span><span class=s1>&#39;</span><span class=p>)</span>
        <span class=k>print</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Creating page: {0}/index.md</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dir_path</span><span class=p>)</span><span class=p>)</span>

        <span class=c1># タグを整理する</span>
        <span class=n>tags_list</span> <span class=o>=</span> <span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>&#34;</span><span class=s1>{0}</span><span class=s1>&#34;</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=p>)</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>tags</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>,</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>]</span>
        <span class=n>tags_str</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>, </span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tags_list</span><span class=p>)</span>

        <span class=c1># is draft</span>
        <span class=k>if</span> <span class=n>draft</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>y</span><span class=s1>&#39;</span> <span class=ow>or</span> <span class=n>draft</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>Y</span><span class=s1>&#39;</span><span class=p>:</span>
            <span class=n>is_draft</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>true</span><span class=s1>&#39;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>is_draft</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>false</span><span class=s1>&#39;</span>

        <span class=n>dt_now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=p>)</span>
        <span class=n>header</span> <span class=o>=</span> <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>---</span><span class=s2>
</span><span class=s2></span><span class=s2>title: </span><span class=s2>&#34;</span><span class=s2>{0}</span><span class=s2>&#34;</span><span class=s2>
</span><span class=s2></span><span class=s2>description: </span><span class=s2>&#34;</span><span class=s2>{1}</span><span class=s2>&#34;</span><span class=s2>
</span><span class=s2></span><span class=s2>image: </span><span class=s2>&#34;</span><span class=s2>{2}</span><span class=s2>&#34;</span><span class=s2>
</span><span class=s2></span><span class=s2>date: {3}</span><span class=s2>
</span><span class=s2></span><span class=s2>tags: [{4}]</span><span class=s2>
</span><span class=s2></span><span class=s2>archives: [</span><span class=s2>&#34;</span><span class=s2>{5}</span><span class=s2>&#34;</span><span class=s2>]</span><span class=s2>
</span><span class=s2></span><span class=s2>draft: {6}</span><span class=s2>
</span><span class=s2></span><span class=s2>---</span><span class=s2>
</span><span class=s2></span><span class=s2>        </span><span class=s2>&#34;&#34;&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>desc</span><span class=p>,</span> <span class=n>img</span><span class=p>,</span> <span class=n>dt_now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>%</span><span class=s1>Y-</span><span class=s1>%</span><span class=s1>m-</span><span class=si>%d</span><span class=s1>T</span><span class=s1>%</span><span class=s1>H:</span><span class=s1>%</span><span class=s1>M:</span><span class=s1>%</span><span class=s1>S+09:00</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>,</span>
                   <span class=n>tags_str</span><span class=p>,</span> <span class=n>dt_now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>%</span><span class=s1>Y-</span><span class=s1>%</span><span class=s1>m</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>,</span> <span class=n>is_draft</span><span class=p>)</span>

        <span class=c1># ファイル作成</span>
        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>dir_path</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>dir_path</span> <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>/index.md</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>w</span><span class=s1>&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>header</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Edit page.</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=c1># 規定のエディタを取得して編集</span>
    <span class=n>EDITOR</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>EDITOR</span><span class=s1>&#39;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>vim</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>run</span><span class=p>(</span><span class=p>[</span><span class=n>EDITOR</span><span class=p>,</span> <span class=n>dir_path</span> <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>/index.md</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>)</span>
    <span class=n>open_finder</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Open in Finder?(Y/n): </span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>open_finder</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>y</span><span class=s1>&#39;</span> <span class=ow>or</span> <span class=n>open_finder</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>Y</span><span class=s1>&#39;</span><span class=p>:</span>
        <span class=n>run</span><span class=p>(</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>open</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>dir_path</span><span class=p>]</span><span class=p>)</span>
    <span class=k>print</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>Finished.</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>Stopped(Keyboard Interrupt).</span><span class=s1>&#39;</span><span class=p>)</span>

</code></pre></div><p><a href=https://github.com/tbsmcd/tbsmcd.github.io/blob/e4be2b4a8f72f87e9ca66c4727452002e77908eb/create.py>リンク</a></p><p>これをコマンドラインで実行すると、以下のように対話的にメタ情報を求められ、結果は index.md に反映される。あとはエディタが index.md を開いてくれるので編集するだけ。おまけとして画像を配置するための <code>open</code> コマンドも <code>Open in Finder?(Y/n):</code> として対話的に実行しているので、ストレスフリーが実現する（最高だね）。</p><pre><code>➤ ./create.py
Directory name: tired-from-hugo-new
tired-from-hugo-new
Create new page.
Title: hugo new で記事を新規作成するのは少しダルいから自作スクリプトで編集する
Description: hugo new で記事を新規作成するのは少しダルいので Pyhton で対話的に記事を作成できるスクリプトを書いて使用している。
OGP image: program.png
Tags(comma separated): hugo, Python
Draft(Y/n): n
</code></pre><h2 id=heading>まとめ</h2><p>hugo はよく出来ている。しかしよく出来ているソフトウェアも、自分に合わない部分がある。それならば適当なスクリプトで修正していけば良い。もしくは Pull Request を送ろう。幸い hugo は markdown という比較的単純なテキストファイルをベースに記事を作成する。テキストファイルを介して hugo と自作スクリプト間をやり取りするのは、 UNIX 的ともいえるのではないか。そういう気持ちで各自やっていけばアウトプットが楽になるのではないかと思う。</p></main><p>Tags:
<a href=/tags/hugo>hugo</a>
<a href=/tags/python>Python</a></p><footer><hr>Written by Mochida Tsubasa(@tbsmcd). <a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a> <a href=/index.xml>Feed</a></footer></body></html>