<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>GitHub Actions を github.com/GitHub Enterprise で共通化するために `${{ github.event }}/GITHUB_EVENT_PATH` を使ってほしい | tbsmcd.net</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/custom.css><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/using-github-event-path/"><meta property="og:title" content="GitHub Actions を github.com/GitHub Enterprise で共通化するために `${{ github.event }}/GITHUB_EVENT_PATH` を使ってほしい | tbsmcd"><meta property="og:description" content="GitHub Actions を github.com/GitHub Enterprise で共通化するためには ${{ github.event }}/GITHUB_EVENT_PATH が有効的。特に API を叩く時には便利。"><meta property="og:image" content="https://tbsmcd.net/post/using-github-event-path/header.png"></head><body><header>tbsmcd.net : <a href=/>Home</a> | <a href=/archives/>Archives</a> | <a href=/tags/>Tags</a> | <a href=/search/>Search</a> | <a href=/profile/>Profile</a></header><main><h1 class=single>GitHub Actions を github.com/GitHub Enterprise で共通化するために <code>${{ github.event }}/GITHUB_EVENT_PATH</code> を使ってほしい</h1><p class=article-date>2021-03-17</p><div class=in-article-list><p class=in-article-list-p>Series: label_timer</p><ul class=page-list><li><span class=list-date>2021/03/17</span><br><a href=/post/using-github-event-path/>GitHub Actions を github.com/GitHub Enterprise で共通化するために <code>${{ github.event }}/GITHUB_EVENT_PATH</code> を使ってほしい</a></li><li><span class=list-date>2021/03/11</span><br><a href=/post/label-timer/>Issue, Pull Request のリードタイムを計測できる GitHub Action「Label timer」をリリースした</a></li></ul></div><p>この記事は <a href=https://github.com/marketplace/actions/label-timer>Label timer</a> を開発したことで得られた知見。</p><p>先に本題を</p><h2 id=github-enterprise--githubcom--api->GitHub Enterprise と github.com では API のエンドポイントが違うから</h2><p>　GitHub Enterprise は利用する人たちがそれぞれホストしているものだから、URL はバラバラなはず。GitHub Actions で GitHub API を叩く記事を Qiita やブログで探すと、ドメインを api.github.com 固定で書いているものがいくつかあった。これは GitHub Enterprise では使えない。しかし <code>${{ github.event }}</code> や <code>GITHUB_EVENT_PATH</code> から API エンドポイントを取得したらその差異を考えなくても動く。できることならドメイン決め打ちではなく、<code>${{ github.event }}</code> や <code>GITHUB_EVENT_PATH</code> を使って書いてもらえると色々な環境で使えて便利なのではないかと思う。</p><h2 id=-events->以下 events について簡単に説明</h2><p><a href=https://docs.github.com/ja/actions/reference/events-that-trigger-workflows>ワークフローをトリガーするイベント - GitHub Docs</a></p><p>　上記ドキュメントにある通り、たとえばトリガしたイベントの内容を取得するには workflow の yml の中で <code>${{ github.event.issue.number }}</code> などを使えば良い。また Actions のスクリプト中では <code>GITHUB_EVENT_PATH</code> を用いて <code>${{ github.event }}</code> の内容とおなじ json ファイルを取得することができる。たとえば Python なら</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>GITHUB_EVENT_PATH</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
	<span class=n>events</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
	<span class=n>action</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>action</span><span class=s1>&#39;</span><span class=p>]</span>
</code></pre></div><p>のように。Pull Request にラベルが付いたことを契機とするものであれば、 <code>action</code> には <code>labeled</code> が代入される。</p><p>　この <code>events</code> には API エンドポイントや各種 URL も含まれている。例として Pull Request 契機であれば</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>url</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>pull_request</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>_links</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>html</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>href</span><span class=s1>&#39;</span><span class=p>]</span>
<span class=n>api_url</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>pull_request</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>_links</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>comments</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>href</span><span class=s1>&#39;</span><span class=p>]</span>
</code></pre></div><p>で契機となった Pull Request の URL や Pull Request のコメントを操作する API エンドポイントを取得できる。</p></main><p>Tags:
<a href=/tags/github-actions>GitHub Actions</a></p><footer><hr>Written by Mochida Tsubasa(@tbsmcd). <a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a> <a href=/index.xml>Feed</a></footer></body></html>