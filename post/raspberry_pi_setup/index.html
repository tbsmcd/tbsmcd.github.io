<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Raspberry Pi セットアップ 2020 春 ~ SSH + VNC 接続まで | tbsmcd</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/fonts.css><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/raspberry_pi_setup/"><meta property="og:title" content="Raspberry Pi セットアップ 2020 春 ~ SSH + VNC 接続まで | tbsmcd"><meta property="og:description" content="Raspberry Pi をセットアップ。2020年春の記録。SSH, VNC"><meta property="og:image" content="https://tbsmcd.net/post/raspberry_pi_setup/ssh.png"></head><body><header>tbsmcd : <a href=/>Index</a> | <a href=/archives/>Archives</a> | <a href=/tags/>Tags</a> | <a href=/search/>Search</a> | <a href=/profile/>Profile</a></header><main><h1 class=single>Raspberry Pi セットアップ 2020 春 ~ SSH + VNC 接続まで</h1><p class=article-date>2020-03-19</p><h2 id=heading>前提</h2><p>作業環境は macOS Mojave</p><h2 id=heading-1>買ったもの</h2><h3 id=heading-2>本体とストレージ</h3><div><a href="https://www.amazon.co.jp/gp/product/B01NHEBAN5/ref=as_li_ss_il?ie=UTF8&psc=1&linkCode=li2&tag=tbsmcd-22&linkId=918ff93f96b787b30247dfdbd1532ffa&language=ja_JP" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B01NHEBAN5&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=tbsmcd-22&language=ja_JP"></a>
<a href="https://www.amazon.co.jp/gp/product/B009D79VH4/ref=as_li_ss_il?ie=UTF8&psc=1&linkCode=li2&tag=tbsmcd-22&linkId=308761c98124ac120da819cbbd809c1e&language=ja_JP" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B009D79VH4&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=tbsmcd-22&language=ja_JP"></a>
<a href="https://www.amazon.co.jp/gp/product/B07YLT539N/ref=as_li_ss_il?ie=UTF8&psc=1&linkCode=li2&tag=tbsmcd-22&linkId=f39de52f3a25628346ad5906ddc0012d&language=ja_JP" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B07YLT539N&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=tbsmcd-22&language=ja_JP"></a></div><h3 id=heading-3>電源周り</h3><div><a href="https://www.amazon.co.jp/gp/product/B0197AP6B6/ref=as_li_ss_il?ie=UTF8&psc=1&linkCode=li2&tag=tbsmcd-22&linkId=962dbe9cc3f58c0d5a2984f26c6a174c&language=ja_JP" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B0197AP6B6&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=tbsmcd-22&language=ja_JP"></a>
<a href="https://www.amazon.co.jp/gp/product/B07TX8RT8L/ref=as_li_ss_il?ie=UTF8&psc=1&linkCode=li2&tag=tbsmcd-22&linkId=63a5417deaec890f25a05ee5ae15ac65&language=ja_JP" target=_blank><img border=0 src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B07TX8RT8L&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=tbsmcd-22&language=ja_JP"></a></div><p>USB 接続のキーボード、マウスなどは家に転がっているもので良い。</p><h2 id=osraspbian->OS(Raspbian) ダウンロード</h2><p><a href=https://www.raspberrypi.org/downloads/raspbian/>Download Raspbian for Raspberry Pi</a> に3種類あり、大（デスクトップ環境に LibreOffice などいろいろ入ってる）中（デスクトップ環境がある）小（CUI）という感じ。今回は中（Raspbian Buster with desktop）を選んだ。ただしここから直接ダウンロードすると数時間かかるようだったので、国内のミラーからダウンロードした。</p><ul><li><a href=https://www.raspbian.org/RaspbianMirrors>RaspbianMirrors - Raspbian</a></li></ul><p>今回は JAIST を選択。</p><h2 id=microsd->microSD の準備</h2><p><a href=https://www.raspberrypi.org/documentation/installation/installing-images/mac.md>公式ドキュメント</a>を参考に。</p><h3 id=heading-4>フォーマット</h3><p>microSD を接続しターミナルで <code>diskutil list</code></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>➤ diskutil list
/dev/disk0 <span class=o>(</span>internal<span class=o>)</span>:
   <span class=c1>#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   0:      GUID_partition_scheme                         251.0 GB   disk0
   1:                        EFI EFI                     314.6 MB   disk0s1
   2:                 Apple_APFS Container disk1         250.7 GB   disk0s2

/dev/disk1 <span class=o>(</span>synthesized<span class=o>)</span>:
   <span class=c1>#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   0:      APFS Container Scheme -                      +250.7 GB   disk1
                                 Physical Store disk0s2
   1:                APFS Volume Macintosh HD            73.7 GB    disk1s1
   2:                APFS Volume Preboot                 45.5 MB    disk1s2
   3:                APFS Volume Recovery                510.4 MB   disk1s3
   4:                APFS Volume VM                      3.2 GB     disk1s4

/dev/disk2 <span class=o>(</span>external, physical<span class=o>)</span>:
   <span class=c1>#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   0:     FDisk_partition_scheme                        *31.9 GB    disk2
   1:             Windows_FAT_32 NO NAME                 31.9 GB    disk2s1
</code></pre></div><p><code>/dev/disk2</code> が microSD なので、新品なら多くの場合 <code>FAT-32</code> になっているのでフォーマットの必要はないと思う（<code>/dev/disk2</code> 部分は、他のメディアを接続していたりすると変わる）。もしフォーマットする場合は以下の通り。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>➤ diskutil eraseDisk MS-DOS RP0 /dev/disk2
Started erase on disk2
Unmounting disk
Creating the partition map
Waiting <span class=k>for</span> partitions to activate
Formatting disk2s2 as MS-DOS <span class=o>(</span>FAT<span class=o>)</span> with name RP0
<span class=m>512</span> bytes per physical sector
/dev/rdisk2s2: <span class=m>61891008</span> sectors in <span class=m>1934094</span> FAT32 clusters <span class=o>(</span><span class=m>16384</span> bytes/cluster<span class=o>)</span>
<span class=nv>bps</span><span class=o>=</span><span class=m>512</span> <span class=nv>spc</span><span class=o>=</span><span class=m>32</span> <span class=nv>res</span><span class=o>=</span><span class=m>32</span> <span class=nv>nft</span><span class=o>=</span><span class=m>2</span> <span class=nv>mid</span><span class=o>=</span>0xf8 <span class=nv>spt</span><span class=o>=</span><span class=m>32</span> <span class=nv>hds</span><span class=o>=</span><span class=m>255</span> <span class=nv>hid</span><span class=o>=</span><span class=m>411648</span> <span class=nv>drv</span><span class=o>=</span>0x80 <span class=nv>bsec</span><span class=o>=</span><span class=m>61921280</span> <span class=nv>bspf</span><span class=o>=</span><span class=m>15111</span> <span class=nv>rdcl</span><span class=o>=</span><span class=m>2</span> <span class=nv>infs</span><span class=o>=</span><span class=m>1</span> <span class=nv>bkbs</span><span class=o>=</span><span class=m>6</span>
Mounting disk
Finished erase on disk2
</code></pre></div><p><code>RP0</code> は自分で設定したデバイス名なので、任意で良い。</p><h3 id=heading-5>イメージの書き込み</h3><p>microSD をアンマウントし、</p><pre><code>➤ diskutil umountDisk /dev/disk2
Unmount of all volumes on disk2 was successful
</code></pre><p>ダウンロードしたイメージを書き込む（path は個々人の環境による）。</p><pre><code>➤ sudo dd bs=1m if=/path/to/2020-02-13-raspbian-buster.img of=/dev/rdisk2 conv=sync
</code></pre><p><code>of=/dev/disk2</code> とした場合はバッファを通して書き込むのに対し、<code>/dev/disk2</code> とした場合はバッファを通さないので早い（はず）。</p><p>eject はデスクトップから行った。</p><h2 id=heading-6>本体を起動</h2><p>イメージを書き込んだ microSD を Raspberry Pi に挿入し、電源用の Micro USB を挿せば起動する。ディスプレイ・キーボード・マウスも接続しておく。いまどきの Raspbian は設定ウィザードが充実しているので、求められる通りに設定していけば Wi-Fi の設定まで完了する。楽すぎる……</p><h2 id=ssh->SSH 接続</h2><h3 id=ssh--1>SSH 有効化</h3><p>キーボードは接続したものの、ふだんから慣れているデバイスで操作したいというのが人類の性。なので SSH 接続できるようにする。
といっても、メニュー > 設定 > Raspberry Pi の設定 から</p><a href=/post/raspberry_pi_setup/ssh.png><img src=/post/raspberry_pi_setup/ssh_hu657eb6a1bae2f67d55ea7de026341cc3_2637457_600x0_resize_q90_box_2.png alt="ssh 設定"></a><p>とすれば有効になる。簡単。</p><h3 id=heading-7>ホスト名で接続</h3><p>ついでにホスト名で接続したいので、まずはファイル編集用に Vim をインストール。Raspberry Pi のターミナルで</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ sudo apt-get update
$ sudo apt-get install vim
</code></pre></div><p><code>/etc/hostname</code> の編集</p><pre><code>$ sudo vim /etc/hostname
</code></pre><pre><code>rp0.local
</code></pre><p>とする（rp0 は任意のホスト名に変更）。</p><p><code>/etc/hosts</code> の編集</p><pre><code>$ sudo vim /etc/hosts
</code></pre><pre><code>127.0.1.1	rp0
</code></pre><p>を追加で書き込む(rp0は以下略)。</p><p>一旦再起動したら、 mac のターミナルから</p><pre><code>➤ ssh pi@rp0.local
</code></pre><p>とすればログインできる（rp0は）。</p><h2 id=heading-8>リモートデスクトップの設定</h2><h3 id=raspberry-pi--vnc->Raspberry Pi に VNC サーバをインストール</h3><pre><code>$ sudo apt-get install tightvncserver
</code></pre><p>でインストールできるので、完了したら</p><pre><code>$ tightvncserver
</code></pre><p>で起動できる。初回は VNC 用にパスワードを設定するよう要求されるので適切なものを設定する。</p><h3 id=mac->mac から接続</h3><p>Finder のメニューから 移動 > サーバへ接続 を選択し、</p><a href=/post/raspberry_pi_setup/vnc.png><img src=/post/raspberry_pi_setup/vnc_huea02d24b2d9e2ccf2e60647b0cec08fb_229248_400x0_resize_q90_box_2.png alt="ssh 設定"></a><p>（rp0はホスト名なので以下略）</p><p>以上でひとまずの動作環境は出来た。</p></main><p>Tags:
<a href=/tags/raspberry-pi>Raspberry Pi</a></p><footer><hr>Written by @tbsmcd. <a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a> <a href=/index.xml>Feed</a></footer></body></html>