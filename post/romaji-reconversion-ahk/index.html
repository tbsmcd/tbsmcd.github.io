<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>AHK(AutoHotkey) V2.0系でローマ字再変換 | tbsmcd.net</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/scss/code.min.daf683076712a8fd05c112ad6575fb841b4d15640f4c87e71541744189b69260.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/scss/custom.min.dcf256d5a0f85d18db523a5742d3f1412ce692686a316cdd6de48b9b0214c4dd.css><script src=/js/main.js defer></script><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/romaji-reconversion-ahk/"><meta property="og:title" content="AHK(AutoHotkey) V2.0系でローマ字再変換 | tbsmcd"><meta property="og:description" content="IME オフのときにローマ字入力したのを AutoHotkey V2.0 系で再変換する"><meta name=description content="IME オフのときにローマ字入力したのを AutoHotkey V2.0 系で再変換する"><meta property="og:image" content="https://tbsmcd.net/post/romaji-reconversion-ahk/ogp.png"></head><body><div class=wrapper><header><div class=title-container><div class="title-item site-title">tbsmcd.net</div><div class=title-item><input type=checkbox id=cb-dark-theme> Dark mode</div></div><div><a href=/><span>index</span></a>, <a href=/archives/><span>archives</span></a>, <a href=/tags/><span>tags</span></a>, <a href=/search/><span>search</span></a>, <a href=/profile/><span>profile</span></a></div></header><main><h1 class=h1-mono-post><span>AHK(AutoHotkey) V2.0系でローマ字再変換</span></h1><div class=article-date-box><p class=article-date>Created: 2024-03-14</p></div><p><a href=https://tbsmcd.net/post/my-first-ahk/>前回</a>の続き。</p><h2 id=ime->IME オフになってるのに気付かずタイピングしたとき</h2><p>　ダルい。基本的にディスプレイを見ていても何文字かは止まらずに打ってしまい、IME を有効にしたあとに再度打つ羽目に。こういう時のための AutoHotkey の設定を先人は残してくれている。</p><ul><li><a href=https://yuruaki.blog.fc2.com/blog-entry-41.html>https://yuruaki.blog.fc2.com/blog-entry-41.html</a></li></ul><p>これをリスペクトしつつ、自身が必要な機能を V2.0 系で書き直してみた。</p><h2 id=heading>実装</h2><ul><li>AHK V2.0 系で動く</li><li>Alt 2連打で発火<ul><li>クリップボードの中身は退避する</li><li>選択中のテキストが「半角英数-~」のｍ1文字以上だった場合に<ul><li>選択中のテキストをコピー</li><li>IME オンにしてコピーした文字列をタイピング<ul><li>つまり文字列選択をしていない場合などはスルー</li></ul></li></ul></li><li>クリップボードの中身をもとに戻す</li><li>終了</li></ul></li></ul><p>ということをする</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>/*
===================================
ローマ字を再変換
Alt 2連打で発火 Interval &lt;= 400ms
選択中のテキストが `半角英数-~のみ1文字以上` の場合だけ有効
===================================
*/

Alt::{
    if (A_ThisHotkey == A_PriorHotkey &amp;&amp; A_TimeSincePriorHotkey &lt;= 400) {
        clip_data := ClipboardAll()
        A_Clipboard := &#34;&#34;
        Send &#34;^c&#34;
        ClipWait 0.5
        copied := String(A_Clipboard)
        if (RegExMatch(copied, &#34;^[0-9a-zA-Z\-\~]+$&#34;)) {
            Send &#34;{F13}&#34; copied
        }
        A_Clipboard := clip_data
        return
    }
}
</code></pre></div><p>ポイントとしては ClipWait が必要なところ。直前に <code>Ctrl + c</code> を送出しているのだが、送出する命令はつまりクリップボードの状態など関係なく次に進む。それを防ぐためにクリップボードへの代入を待機することが必要となる。</p><p><code>String(A_Clipboard)</code> は何か文字列以外のものをコピーしてしまった場合のためだが、不要かもしれない。</p><p><code>.,</code> については文を入力するに至ることは無いと考えて除外している。</p></main><div class=tag-list>Tags:
<span><a href=/tags/autohotkey>AutoHotkey</a></span>
<span><a href=/tags/windows>Windows</a></span></div><footer>Mochida Tsubasa (@tbsmcd)<br><a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a>, <a href=/index.xml>Feed</a></footer></div></body></html>