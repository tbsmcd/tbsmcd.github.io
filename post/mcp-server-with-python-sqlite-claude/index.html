<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>MCP サーバに入門した(W/ Python, SQLite, Claude) | tbsmcd.net</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/scss/code.min.daf683076712a8fd05c112ad6575fb841b4d15640f4c87e71541744189b69260.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/scss/custom.min.dcf256d5a0f85d18db523a5742d3f1412ce692686a316cdd6de48b9b0214c4dd.css><script src=/js/main.js defer></script><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/mcp-server-with-python-sqlite-claude/"><meta property="og:title" content="MCP サーバに入門した(W/ Python, SQLite, Claude) | tbsmcd"><meta property="og:description" content="MCP サーバに入門。Python + SQLite で CRUD するアプリケーションを Claude Desktop から操る。"><meta name=description content="MCP サーバに入門。Python + SQLite で CRUD するアプリケーションを Claude Desktop から操る。"><meta property="og:image" content="https://tbsmcd.net/post/mcp-server-with-python-sqlite-claude/ogp.png"></head><body><div class=wrapper><header><div class=title-container><div class="title-item site-title">tbsmcd.net</div><div class=title-item><input type=checkbox id=cb-dark-theme> Dark mode</div></div><div><a href=/><span>index</span></a>, <a href=/archives/><span>archives</span></a>, <a href=/tags/><span>tags</span></a>, <a href=/search/><span>search</span></a>, <a href=/profile/><span>profile</span></a></div></header><main><h1 class=h1-mono-post><span>MCP サーバに入門した(W/ Python, SQLite, Claude)</span></h1><div class=article-date-box><p class=article-date>Created: 2025-04-18</p></div><p>　MCP が話題になってしばらく経つが、最近ようやく RAG 関連の案件が落ち着いたのでいまさら触ってみる。</p><h2 id=mcp->MCP とは？</h2><p><a href=https://github.com/modelcontextprotocol>https://github.com/modelcontextprotocol</a></p><p>　ざっくりいうと生成AIアプリと外部サービス/アプリが連携するためのプロトコル。くわしい話はたくさんあるのだけどこのページの趣旨ではないので他を読んでほしい。</p><h2 id=heading>下準備</h2><h3 id=claude-desktop->Claude Desktop のインストール</h3><p>　Mac/Windows の場合は<a href=https://claude.ai/download>公式サイト</a>からダウンロードしたら良いんだけど、自分は Linux (Kubuntu) を使っているのでこちらから<a href=https://github.com/aaddrick/claude-desktop-debian>インストール</a>した。ありがたい。</p><h3 id=uv->uv のインストール</h3><p>　<a href=https://github.com/modelcontextprotocol/python-sdk>MCP Python SDK</a> が uv でのパッケージ管理を推奨してるっぽいし、Python のバージョンとパッケージを統合的に管理でき気軽に仮想環境として使えるので今回の開発に向いている。</p><p><a href=https://docs.astral.sh/uv/getting-started/installation/>https://docs.astral.sh/uv/getting-started/installation/</a></p><p>ここに従ってインストールしたらよい。cargo コマンドがインストールされていることが求められる場面があるので、 rust もインストールしたほうがいいと思う。</p><h2 id=-mcp->作りたい MCP サーバ</h2><p>　MCP サーバの入門として天気 API を用いることが多い。しかし、たとえば <a href="https://github.com/modelcontextprotocol/python-sdk?tab=readme-ov-file#tools">Tools の説明</a>として <code>Tools let LLMs take actions through your server. Unlike resources, tools are expected to perform computation and have side effects:</code> （計算をしたり副作用を持つことが期待されている）とあるのを考えると、 Web アプリケーションでいうところの Create, Update, Delete ができたほうが面白いし分かりやすいんじゃないかと考えた。そこでとても簡単な CRUD ができるものを作ることにした。</p><p>　具体的には SQLite に以下のようなテーブルを用意し、</p><ul><li>メンバー一覧の取得</li><li>メンバーの取得</li><li>メンバーのアップデート</li><li>メンバーの削除</li></ul><p>をおこなうことにした。</p><div class=highlight><pre class=chroma><code class=language-sql data-lang=sql><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=s2>&#34;</span><span class=s2>members</span><span class=s2>&#34;</span> <span class=p>(</span>
	<span class=s2>&#34;</span><span class=s2>id</span><span class=s2>&#34;</span>	<span class=nb>INTEGER</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
	<span class=s2>&#34;</span><span class=s2>name</span><span class=s2>&#34;</span>	<span class=nb>TEXT</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
	<span class=s2>&#34;</span><span class=s2>age</span><span class=s2>&#34;</span>	<span class=nb>INTEGER</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
	<span class=k>PRIMARY</span> <span class=k>KEY</span><span class=p>(</span><span class=s2>&#34;</span><span class=s2>id</span><span class=s2>&#34;</span> <span class=n>AUTOINCREMENT</span><span class=p>)</span>
<span class=p>)</span><span class=p>;</span>
</code></pre></div><h2 id=-mcp--1>実際に作った MCP サーバ</h2><h3 id=heading-1>環境作成</h3><p>　作業ディレクトリ内で <code>uv init</code> をしてから <code>uv add "mcp[cli]”</code> でパッケージをインストールする。MCP サーバのコードは <a href=http://main.py/>main.py</a> に書いていく。</p><p><a href=https://github.com/tbsmcd/mcp_members/blob/main/main.py>https://github.com/tbsmcd/mcp_members/blob/main/main.py</a></p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>os</span>
<span class=kn>from</span> <span class=nn>mcp.server.fastmcp</span> <span class=kn>import</span> <span class=n>FastMCP</span>
<span class=kn>import</span> <span class=nn>sqlite3</span>
<span class=kn>from</span> <span class=nn>contextlib</span> <span class=kn>import</span> <span class=n>contextmanager</span>

<span class=nd>@contextmanager</span>
<span class=k>def</span> <span class=nf>get_db_connection</span><span class=p>(</span><span class=p>)</span><span class=p>:</span>
    <span class=nb>dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span>
    <span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>{dir}/db/members.db</span><span class=s2>&#34;</span><span class=p>)</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=k>yield</span> <span class=n>conn</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>(</span><span class=p>)</span>


<span class=n>mcp</span> <span class=o>=</span> <span class=n>FastMCP</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>members</span><span class=s2>&#34;</span><span class=p>)</span>
</code></pre></div><h3 id=resources>Resources</h3><p>　<a href="https://github.com/modelcontextprotocol/python-sdk?tab=readme-ov-file#resources">こちらのドキュメント</a>によるとREST API の GET のようなものらしいので、とりあえずそれらしいものを作成する。ただし Claude Desktop ではパラメータが動的な GET は使えないようなので <code>list_members()</code> しか試していない。<code>list_resources()</code> として渡せるようにしたら使えるのかも。</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=nd>@mcp.resource</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>members://list</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>list_members</span><span class=p>(</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>List all ABC-BAND members.</span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members</span><span class=s2>&#34;</span><span class=p>)</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>(</span><span class=p>)</span>
    <span class=n>mem</span> <span class=o>=</span>  <span class=p>[</span><span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>id: {member[0]}, name: {member[1]}, age: {member[2]}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>member</span> <span class=ow>in</span> <span class=n>members</span><span class=p>]</span>
    <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>mem</span><span class=p>)</span>


<span class=nd>@mcp.resource</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>members://id/{id}</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>get_member_by_id</span><span class=p>(</span><span class=nb>id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>Get a ABC-BAND member by ID.</span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members WHERE id=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nb>id</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>member</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>(</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>member</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>if: {member[0]}, name: {member[1]}, age: {member[2]}</span><span class=s2>&#34;</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>Member not found</span><span class=s2>&#34;</span>
    
<span class=nd>@mcp.resource</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>members://name/{name}</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>get_members_by_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>Get a ABC-BAND member by name.</span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members WHERE name=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>(</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>members</span><span class=p>:</span>
        <span class=n>mem</span> <span class=o>=</span>  <span class=p>[</span><span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>id: {member[0]}, name: {member[1]}, age: {member[2]}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>member</span> <span class=ow>in</span> <span class=n>members</span><span class=p>]</span>
        <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>mem</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>Member not found</span><span class=s2>&#34;</span>

</code></pre></div><h3 id=tools>Tools</h3><p>　前述したように Create, Update, Delete 相当の機能を実装するが、「computation」する役割も担うので Read 相当の役割があっても良いと思う。例えば DB から取得したレコードを読み取りやすい形に変更したりしても良いと考えて Read 相当の機能も実装した。</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=nd>@mcp.tool</span><span class=p>(</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>add_member</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>age</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>Add a new ABC-BAND member.</span><span class=s2>
</span><span class=s2></span><span class=s2>    Args:</span><span class=s2>
</span><span class=s2></span><span class=s2>        name: Name of the member.</span><span class=s2>
</span><span class=s2></span><span class=s2>        age: Age of the member.</span><span class=s2>
</span><span class=s2></span><span class=s2>    </span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>INSERT INTO members (name, age) VALUES (?, ?)</span><span class=s1>&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>)</span><span class=p>)</span>
        <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members WHERE name = ? ORDER BY id DESC</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>member</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>(</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>member</span> <span class=ow>is</span> <span class=bp>None</span><span class=p>:</span>
        <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>Failed to add member</span><span class=s2>&#34;</span>
    <span class=k>return</span> <span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>Added member: id: {member[0]}, name: {member[1]}, age: {member[2]}</span><span class=s2>&#34;</span>


<span class=nd>@mcp.tool</span><span class=p>(</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_member</span><span class=p>(</span><span class=nb>id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>Remove a ABC-BAND member by ID.</span><span class=s2>
</span><span class=s2></span><span class=s2>    Args:</span><span class=s2>
</span><span class=s2></span><span class=s2>        id: ID of the member.</span><span class=s2>
</span><span class=s2></span><span class=s2>    </span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members WHERE id=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nb>id</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>member</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>(</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>member</span> <span class=ow>is</span> <span class=bp>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>Member not found</span><span class=s2>&#34;</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>DELETE FROM members WHERE id=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nb>id</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>(</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>Removed member with ID: {id}</span><span class=s2>&#34;</span>

<span class=nd>@mcp.tool</span><span class=p>(</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>update_member</span><span class=p>(</span><span class=nb>id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>age</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>Update a ABC-BAND member by ID.</span><span class=s2>
</span><span class=s2></span><span class=s2>    Args:</span><span class=s2>
</span><span class=s2></span><span class=s2>        id: ID of the member.</span><span class=s2>
</span><span class=s2></span><span class=s2>        name: New name of the member.</span><span class=s2>
</span><span class=s2></span><span class=s2>        age: New age of the member.</span><span class=s2>
</span><span class=s2></span><span class=s2>    </span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members WHERE id=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nb>id</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>member</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>(</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>member</span> <span class=ow>is</span> <span class=bp>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>Member not found</span><span class=s2>&#34;</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>UPDATE members SET name=?, age=? WHERE id=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>age</span><span class=p>,</span> <span class=nb>id</span><span class=p>)</span><span class=p>)</span>
        <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members WHERE id=?</span><span class=s2>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nb>id</span><span class=p>,</span><span class=p>)</span><span class=p>)</span>
        <span class=n>member</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>(</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>Updated member: id: {member[0]}, name: {member[1]}, age: {member[2]}</span><span class=s2>&#34;</span>
    
<span class=nd>@mcp.tool</span><span class=p>(</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>list_all_members</span><span class=p>(</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>List all ABC-BAND members.</span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=n>get_db_connection</span><span class=p>(</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>(</span><span class=p>)</span>
        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>SELECT * FROM members</span><span class=s2>&#34;</span><span class=p>)</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>(</span><span class=p>)</span>
    <span class=n>mem</span> <span class=o>=</span>  <span class=p>[</span><span class=n>f</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>id: {member[0]}, name: {member[1]}, age: {member[2]}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>member</span> <span class=ow>in</span> <span class=n>members</span><span class=p>]</span>
    <span class=k>return</span> <span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>mem</span><span class=p>)</span>
</code></pre></div><h3 id=prompts>Prompts</h3><p>　このアプリにおいて使いみちは特に思いつかないのだけど、定形の作業をプロンプトとして呼び出すことを想定して実装した。</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=nd>@mcp.prompt</span><span class=p>(</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>prompt_sort_members_by_age</span><span class=p>(</span><span class=p>)</span> <span class=o>-</span><span class=o>&gt;</span> <span class=nb>str</span><span class=p>:</span>
    <span class=sa></span><span class=s2>&#34;&#34;&#34;</span><span class=s2>Prompt for sorting ABC-BAND member by age.</span><span class=s2>&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>ABC-BAND のメンバーを年齢が若い順に並べてください。回答は必ず日本語でしてください。</span><span class=s1>&#39;</span>
</code></pre></div><h2 id=claude->Claude から呼び出す</h2><p>　Claude Desktop から ファイル > 設定 > 開発者 とたどって行くと設定ファイルを開くことができる。自分の環境では <code>~/.config/Claude/claude_desktop_config.json</code> にある。これを編集し、Claude を再起動する。</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;mcpServers&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;ABC-BAND members&#34;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;command&#34;</span><span class=p>:</span> <span class=s2>&#34;/home/{your name}/.local/bin/uv&#34;</span><span class=p>,</span>
            <span class=nt>&#34;args&#34;</span><span class=p>:</span> <span class=p>[</span>
                <span class=s2>&#34;--directory&#34;</span><span class=p>,</span>
                <span class=s2>&#34;{MCP サーバのディレクトリ}&#34;</span><span class=p>,</span>
                <span class=s2>&#34;run&#34;</span><span class=p>,</span>
                <span class=s2>&#34;main.py&#34;</span>
            <span class=p>]</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><h3 id=resources-1>Resources</h3><p>　チャットの入力欄下部の「MCP から添付」ボタンを押すとアクセスできる。</p><p><img src=0d575796.png alt=20250418_133404_395></p><p>追加の指示を付け加えることもできる。</p><p><img src=ce3a9e41.png alt=20250418_133539_340></p><p>（Claude では）Resouces は本文中から自然言語で呼び出すことができないようなので、Tools でも Read 相当の機能があったほうが便利だろう。</p><h3 id=tools-1>Tools</h3><p>　自然言語から Create, Update, Delete 相当のことができる。</p><p><img src=c2f3df62.png alt=20250418_133757_319></p><br><p><img src=15cee5e7.png alt=20250418_134001_993></p><br><p>削除したあとに Read 相当の動作もさせてみている。「クビにして」でメンバー削除ができてしまうのは怖くもあるので、主に権限周りなどについて MCP サーバーの作成者側の工夫が必要になるかもしれない。</p><h3 id=prompts-1>Prompts</h3><p>　チャットの入力欄下部の「MCPから添付」ボタンを押すとアクセスできる。</p><p><img src=c4334921.png alt=20250418_132806_885></p><p>その際プロンプトに指示を追加すると合わせて実行してくれる。メニューから呼び出したプロンプトには「ABC-BAND のメンバーを年齢が若い順に並べてください。回答は必ず日本語でしてください。」であり、追加で「ただし年齢が偶数の場合は偶数であることを示すように」と指示している。</p><p><img src=ea24bde8.png alt=20250418_133029_682></p><p>プロンプトはもちろんチャットの途中でも呼び出せるので、何らかの結果を加工するプロンプトを作成しても良いだろう。</p><br><h2 id=heading-2>まとめ</h2><p>　CRUD するアプリを作ってみるのは、MCP サーバを理解するのにとても役立つので試してみたら良いと思う。</p></main><div class=tag-list>Tags:
<span><a href=/tags/mcp>MCP</a></span></div><footer>Mochida Tsubasa (@tbsmcd)<br><a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a>, <a href=/index.xml>Feed</a></footer></div></body></html>