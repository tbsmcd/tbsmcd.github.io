<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>blog ダークモード対応（2）OS のモードに対応する方法 | tbsmcd.net</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/scss/code.min.daf683076712a8fd05c112ad6575fb841b4d15640f4c87e71541744189b69260.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/scss/custom.min.e2a487140befbb70e8b54754b183825954a06aedf7e25c9f9b9e7d66f3aefb63.css><script src=/js/theme.js defer></script><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/dark-mode-02/"><meta property="og:title" content="blog ダークモード対応（2）OS のモードに対応する方法 | tbsmcd"><meta property="og:description" content="OS のダークモードに CSS/JavaScript で対応する方法と、ユーザ操作に対応する方法。"><meta name=description content="OS のダークモードに CSS/JavaScript で対応する方法と、ユーザ操作に対応する方法。"><meta property="og:image" content="https://tbsmcd.net/post/dark-mode-02/ogp.png"></head><body><div class=wrapper><header>tbsmcd.net <a href=/><span>index</span></a>, <a href=/archives/><span>archives</span></a>, <a href=/tags/><span>tags</span></a>, <a href=/search/><span>search</span></a>, <a href=/profile/><span>profile</span></a> <input type=checkbox id=cb-dark-theme> Dark theme</header><main><h1 class=h1-mono-post><span>blog ダークモード対応（2）OS のモードに対応する方法</span></h1><div class=article-date-box><p class=article-date>Created: 2022-11-25</p></div><div class=in-article-list><p class=in-article-list-p>Series: <span class=series-name>blogダークモード対応</span></p><ol class=num-page-list reversed><li>2022-11-25 blog ダークモード対応（2）OS のモードに対応する方法</li><li>2022-11-24 <a href=/post/dark-mode-01/>blog ダークモード対応（1）やりたいこと・やるべきことの整理</a></li></ol></div><h2 id=heading>この記事で書くこと</h2><ul><li>CSS だけで OS のダークモードに追従する方法</li><li>JavaScript で OS のダークモードに追従する方法</li><li>ユーザが明示的に指定したカラースキームに対応する方法<ul><li>指定されたカラースキームを保持する方法</li></ul></li><li>実際に行ったこと</li></ul><h2 id=css--os->CSS だけで OS のダークモードに追従する方法</h2><p>　CSS のメディア特性 <code>prefers-color-scheme</code> を使う。</p><p>ref. <a href=https://developer.mozilla.org/ja/docs/Web/CSS/@media/prefers-color-scheme>https://developer.mozilla.org/ja/docs/Web/CSS/@media/prefers-color-scheme</a></p><div class=highlight><pre class=chroma><code class=language-css data-lang=css><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>prefers-color-scheme</span><span class=o>:</span> <span class=nt>dark</span><span class=o>)</span> <span class=p>{</span>
  <span class=nt>body</span> <span class=p>{</span>
    <span class=k>background-color</span><span class=p>:</span> <span class=kc>black</span><span class=p>;</span>
    <span class=k>color</span><span class=p>:</span> <span class=kc>white</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=javascript--os->JavaScript で OS のダークモードに追従する方法</h2><p>　JavaScript でも同様にモードを取得できる。</p><p>ref. <a href=https://developer.mozilla.org/ja/docs/Web/API/Window/matchMedia>https://developer.mozilla.org/ja/docs/Web/API/Window/matchMedia</a></p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=k>if</span> <span class=p>(</span><span class=nx>matchMedia</span><span class=p>(</span><span class=s1>&#39;(prefers-color-scheme: dark)&#39;</span><span class=p>)</span><span class=p>.</span><span class=nx>matches</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// ダークモードのとき
</span><span class=c1></span><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
  <span class=c1>// ダークモードではないとき
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><h2 id=heading-1>ユーザ指定のカラースキームに対応する方法</h2><p>　以下は <code>checkbox</code> で対応する場合。</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;cb-dark-theme&#34;</span><span class=p></span><span class=p>&gt;</span> Dark them
</code></pre></div><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>cbDark</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;cb-dark-theme&#34;</span><span class=p>)</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>setDark</span> <span class=o>=</span> <span class=p>(</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;dark-theme&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=nx>cbDark</span><span class=p>.</span><span class=nx>checked</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
<span class=p>}</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>setLight</span> <span class=o>=</span> <span class=p>(</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s2>&#34;dark-theme&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=nx>cbDark</span><span class=p>.</span><span class=nx>checked</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
<span class=p>}</span>
<span class=nx>cbDark</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;change&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>checked</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>setDark</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nx>setLight</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span><span class=p>)</span><span class=p>;</span>

</code></pre></div><div class=highlight><pre class=chroma><code class=language-css data-lang=css><span class=p>.</span><span class=nc>dark-theme</span> <span class=p>{</span>
  <span class=k>color</span><span class=p>:</span> <span class=mh>#ffffff</span><span class=p>;</span>
  <span class=k>opacity</span><span class=p>:</span> <span class=mf>0.9</span><span class=p>;</span>
  <span class=k>background</span><span class=p>:</span> <span class=err>$</span><span class=n>dark_base_color</span><span class=p>;</span>
<span class=err>（</span><span class=err>略</span><span class=err>）</span>
</code></pre></div><p>通常の JavaScript と同じくイベントを捕捉したら良い。ダークカラースキームのときに <code>.dark-theme</code> を追加し、ライトカラースキームのときに削除しているが、 CSS の書き方によってはライトカラースキームのときに <code>.light-theme</code> を追加するようにしても良いだろう。</p><h3 id=heading-2>状態の保持方法</h3><p>　<code>checkbox</code> で設定した状態はページ遷移したら保持できないので <code>localStorage</code> か <code>sessionStorage</code> を使う。単にページ遷移しても保持したい場合は <code>sessionStorage</code> で良く、ブラウザを閉じても保持したい場合は <code>localStorage</code> を使う。</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=nx>cbDark</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;change&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>checked</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>setDark</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s2>&#34;selectedTheme&#34;</span><span class=p>,</span> <span class=s2>&#34;dark&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nx>setLight</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s2>&#34;selectedTheme&#34;</span><span class=p>,</span> <span class=s2>&#34;light&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span><span class=p>)</span>
</code></pre></div><h2 id=heading-3>実際に行ったこと</h2><p>　前回書いたように</p><ul><li>当 blog においてカラースキームを明示的に選択しない場合は OS のモードに従う</li><li>明示的にカラースキームを選択した場合はそれに従う</li></ul><p>としたいので、</p><ul><li><code>localStorage</code> にモードが保存されている場合はそれに従う</li><li><code>localStorage</code> にモードが保存されていない場合は OS のモードに従う</li><li>ユーザが <code>checkbox</code> を操作した場合はカラースキームを設定し、 <code>localStorage</code> に保存する</li></ul><p>とした。</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>cbDark</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;cb-dark-theme&#34;</span><span class=p>)</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>setDark</span> <span class=o>=</span> <span class=p>(</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;dark-theme&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=nx>cbDark</span><span class=p>.</span><span class=nx>checked</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
<span class=p>}</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>setLight</span> <span class=o>=</span> <span class=p>(</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s2>&#34;dark-theme&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=nx>cbDark</span><span class=p>.</span><span class=nx>checked</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
<span class=p>}</span>
<span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;DOMContentLoaded&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>selectedTheme</span> <span class=o>=</span> <span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s2>&#34;selectedTheme&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>selectedTheme</span> <span class=o>==</span> <span class=s2>&#34;dark&#34;</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>setDark</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>selectedTheme</span> <span class=o>==</span> <span class=s2>&#34;light&#34;</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>setLight</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=kr>const</span> <span class=nx>pcs</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>matchMedia</span><span class=p>(</span><span class=s2>&#34;(prefers-color-scheme: dark)&#34;</span><span class=p>)</span><span class=p>;</span> 
        <span class=k>if</span> <span class=p>(</span><span class=nx>pcs</span><span class=p>.</span><span class=nx>matches</span><span class=p>)</span> <span class=p>{</span>
            <span class=nx>setDark</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=nx>setLight</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span><span class=p>)</span><span class=p>;</span>
<span class=nx>cbDark</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;change&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>checked</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>setDark</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s2>&#34;selectedTheme&#34;</span><span class=p>,</span> <span class=s2>&#34;dark&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nx>setLight</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s2>&#34;selectedTheme&#34;</span><span class=p>,</span> <span class=s2>&#34;light&#34;</span><span class=p>)</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span><span class=p>)</span><span class=p>;</span>
</code></pre></div><br><p>続く。</p></main><p>Tags:
<a href=/tags/css>CSS</a>
<a href=/tags/javascript>JavaScript</a></p><footer>Mochida Tsubasa<br>(@tbsmcd)<br><a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a>, <a href=/index.xml>Feed</a></footer></div></body></html>