<!doctype html><html lang=ja><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-158035573-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158035573-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>言語処理100本ノック 2020 第3章 | tbsmcd.net</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/scss/code.min.daf683076712a8fd05c112ad6575fb841b4d15640f4c87e71541744189b69260.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/scss/custom.min.8ed8d5774a78420bb33b7e56b48fb76ad0d3f9df9ed410c3e99b2648e8f27500.css><script src=/js/theme.js defer></script><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tbsmcd"><meta name=twitter:creator content="@tbsmcd"><meta property="og:url" content="https://tbsmcd.net/post/100knock_3/"><meta property="og:title" content="言語処理100本ノック 2020 第3章 | tbsmcd"><meta property="og:description" content="言語処理100本ノック2020 第3章"><meta name=description content="言語処理100本ノック2020 第3章"><meta property="og:image" content="https://tbsmcd.net/post/100knock_3/ss.png"></head><body><header>tbsmcd.net <a href=/><span>index</span></a>, <a href=/archives/><span>archives</span></a>, <a href=/tags/><span>tags</span></a>, <a href=/search/><span>search</span></a>, <a href=/profile/><span>profile</span></a> <input type=checkbox id=cb-dark-theme> Dark theme</header><main><h1 class=h1-mono-post><span>言語処理100本ノック 2020 第3章</span></h1><p class=article-date>2020-04-29 00:20:15 +0900</p><a href=/post/100knock_3/ss.png><img src=/post/100knock_3/ss_hu26ff06f705f50ba31d9b2963f07486af_130392_400x0_resize_q90_box_2.png alt="Jupyter notebook"></a><p><a href=https://nlp100.github.io/ja/>言語処理100本ノック 2020 - NLP100 2020</a></p><p>関連記事: <a href=/tags/%E8%A8%80%E8%AA%9E%E5%87%A6%E7%90%86100%E6%9C%AC%E3%83%8E%E3%83%83%E3%82%AF/>tag 言語処理100本ノック</a></p><h2 id=code>code</h2><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>target_dir</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>/users/tbsmcd/Documents/</span><span class=s1>&#39;</span>
<span class=n>file_path</span> <span class=o>=</span> <span class=n>target_dir</span> <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>jawiki-country.json.gz</span><span class=s1>&#39;</span>

<span class=c1># 020</span>
<span class=kn>import</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>pprint</span><span class=o>,</span> <span class=nn>gzip</span>

<span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=p>]</span>
<span class=k>with</span> <span class=n>gzip</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>r</span><span class=s1>&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>article</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>article</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>title</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>イギリス</span><span class=s1>&#39;</span><span class=p>:</span>
            <span class=n>uk</span> <span class=o>=</span> <span class=n>article</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>text</span><span class=s1>&#39;</span><span class=p>]</span>
            <span class=k>break</span>

<span class=n>pprint</span><span class=o>.</span><span class=n>pprint</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span>
</code></pre></div><p>gzip モジュールは知らなかった。</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1>#021</span>
<span class=kn>import</span> <span class=nn>re</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>(</span><span class=s1>\</span><span class=s1>[</span><span class=s1>\</span><span class=s1>[Category:.*</span><span class=s1>\</span><span class=s1>]</span><span class=s1>\</span><span class=s1>])</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span>
<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div><p><code>re.MULTILINE</code>(<code>re.M</code>) などのオプションを忘れている。</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1>#022</span>
<span class=kn>import</span> <span class=nn>re</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>[</span><span class=s1>\</span><span class=s1>[Category:(.*)</span><span class=s1>\</span><span class=s1>]</span><span class=s1>\</span><span class=s1>]</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span>
<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div><p>シンプル</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 023</span>
<span class=c1># セクション？</span>
<span class=c1># ref. https://ja.wikipedia.org/wiki/Help:%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3#%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E7%95%AA%E5%8F%B7%E4%BB%98%E3%81%91</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>=(=+)(.+?)=</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span> 
<span class=n>res</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span>
<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>line</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>)</span><span class=p>)</span>
</code></pre></div><p>貪欲マッチの <code>?</code> とかすぐに出てこなくて焦る</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 024</span>
<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>ファイル:(.+?)</span><span class=s1>\</span><span class=s1>|</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span>
<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 025</span>
<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#39;&#39;</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>{</span><span class=s1>\</span><span class=s1>{基礎情報.*?$</span><span class=s1>
</span><span class=s1></span><span class=s1>.*?</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>}</span><span class=s1>\</span><span class=s1>}$</span><span class=s1>
</span><span class=s1></span><span class=s1>&#39;&#39;&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=o>+</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span>
<span class=n>data</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>^</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>s*=</span><span class=s1>\</span><span class=s1>s*(.+?)$</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=p>{</span><span class=p>}</span>
<span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=p>:</span>
    <span class=n>res</span><span class=p>[</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>]</span> <span class=o>=</span> <span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&#39;</span><span class=p>)</span>
</code></pre></div><p>memo: <code>re.DOTALL</code></p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 026</span>
<span class=k>def</span> <span class=nf>strip_markup</span><span class=p>(</span><span class=n>text</span><span class=p>)</span><span class=p>:</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>(</span><span class=se>\&#39;</span><span class=s1>{2,5})(.+?)(</span><span class=s1>\</span><span class=s1>1)</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>M</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>2</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#39;&#39;</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>{</span><span class=s1>\</span><span class=s1>{基礎情報.*?$</span><span class=s1>
</span><span class=s1></span><span class=s1>.*?</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>}</span><span class=s1>\</span><span class=s1>}$</span><span class=s1>
</span><span class=s1></span><span class=s1>&#39;&#39;&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=o>+</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span> 
<span class=n>data</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>^</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>s*=</span><span class=s1>\</span><span class=s1>s*(.+?)$</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=p>{</span><span class=p>}</span>
<span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=p>:</span>
    <span class=n>res</span><span class=p>[</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>]</span> <span class=o>=</span> <span class=n>strip_markup</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>)</span>

<span class=k>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</code></pre></div><p><code>\1</code> を知らなかった。またコンパイル済みの pattern.sub() で pattern の <code>/2</code> が使えるのも当然知らなかった。</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 027</span>
<span class=k>def</span> <span class=nf>strip_markup</span><span class=p>(</span><span class=n>text</span><span class=p>)</span><span class=p>:</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>(</span><span class=se>\&#39;</span><span class=s1>{2,5})(.+?)(</span><span class=s1>\</span><span class=s1>1)</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>M</span><span class=p>)</span>
    <span class=n>text</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>2</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>[</span><span class=s1>\</span><span class=s1>[([^</span><span class=s1>\</span><span class=s1>|]*?)</span><span class=s1>\</span><span class=s1>]</span><span class=s1>\</span><span class=s1>]</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>text</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>1</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>[</span><span class=s1>\</span><span class=s1>[(.+?)</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>]</span><span class=s1>\</span><span class=s1>]</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>2</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#39;&#39;</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>{</span><span class=s1>\</span><span class=s1>{基礎情報.*?$</span><span class=s1>
</span><span class=s1></span><span class=s1>.*?</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>}</span><span class=s1>\</span><span class=s1>}$</span><span class=s1>
</span><span class=s1></span><span class=s1>&#39;&#39;&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=o>+</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span> 
<span class=n>data</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>^</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>s*=</span><span class=s1>\</span><span class=s1>s*(.+?)$</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=p>{</span><span class=p>}</span>
<span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=p>:</span>
    <span class=n>res</span><span class=p>[</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>]</span> <span class=o>=</span> <span class=n>strip_markup</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>)</span>

<span class=k>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 028</span>
<span class=k>def</span> <span class=nf>strip_markup</span><span class=p>(</span><span class=n>text</span><span class=p>)</span><span class=p>:</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>(</span><span class=se>\&#39;</span><span class=s1>{2,5})(.+?)(</span><span class=s1>\</span><span class=s1>1)</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>M</span><span class=p>)</span>
    <span class=n>text</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>2</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>[</span><span class=s1>\</span><span class=s1>[([^</span><span class=s1>\</span><span class=s1>|]*?)</span><span class=s1>\</span><span class=s1>]</span><span class=s1>\</span><span class=s1>]</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>text</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>1</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>[</span><span class=s1>\</span><span class=s1>[(.+?)</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>]</span><span class=s1>\</span><span class=s1>]</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>text</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>2</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>{</span><span class=s1>\</span><span class=s1>{lang</span><span class=s1>\</span><span class=s1>|[^</span><span class=s1>\</span><span class=s1>|]+?</span><span class=s1>\</span><span class=s1>|([^</span><span class=s1>\</span><span class=s1>|]+)</span><span class=s1>\</span><span class=s1>}</span><span class=s1>\</span><span class=s1>}</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>text</span> <span class=o>=</span> <span class=n>pattern</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>\</span><span class=s1>1</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
    <span class=c1># あとの除去は省略</span>
    <span class=k>return</span> <span class=n>text</span>
    

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#39;&#39;</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>{</span><span class=s1>\</span><span class=s1>{基礎情報.*?$</span><span class=s1>
</span><span class=s1></span><span class=s1>.*?</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>}</span><span class=s1>\</span><span class=s1>}$</span><span class=s1>
</span><span class=s1></span><span class=s1>&#39;&#39;&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=o>+</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span> 
<span class=n>data</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>^</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>s*=</span><span class=s1>\</span><span class=s1>s*(.+?)$</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=p>{</span><span class=p>}</span>
<span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=p>:</span>
    <span class=n>res</span><span class=p>[</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>]</span> <span class=o>=</span> <span class=n>strip_markup</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>)</span>

<span class=k>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># 029</span>
<span class=kn>import</span> <span class=nn>sys</span>
<span class=kn>import</span> <span class=nn>pprint</span>
<span class=kn>import</span> <span class=nn>urllib.parse</span><span class=o>,</span> <span class=nn>urllib.request</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#39;&#39;</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>{</span><span class=s1>\</span><span class=s1>{基礎情報.*?$</span><span class=s1>
</span><span class=s1></span><span class=s1>.*?</span><span class=s1>
</span><span class=s1></span><span class=s1>^</span><span class=s1>\</span><span class=s1>}</span><span class=s1>\</span><span class=s1>}$</span><span class=s1>
</span><span class=s1></span><span class=s1>&#39;&#39;&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=o>+</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span> 
<span class=n>data</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>uk</span><span class=p>)</span><span class=p>)</span>

<span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=s1>^</span><span class=s1>\</span><span class=s1>|(.+?)</span><span class=s1>\</span><span class=s1>s*=</span><span class=s1>\</span><span class=s1>s*(.+?)$</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>
<span class=n>res</span> <span class=o>=</span> <span class=p>{</span><span class=p>}</span>
<span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>pattern</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=p>:</span>
    <span class=n>res</span><span class=p>[</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>]</span> <span class=o>=</span> <span class=n>strip_markup</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&#39;</span><span class=p>)</span><span class=p>)</span>

<span class=n>file_name</span> <span class=o>=</span> <span class=n>res</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>国旗画像</span><span class=s1>&#39;</span><span class=p>]</span>

<span class=n>url</span> <span class=o>=</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>https://www.mediawiki.org/w/api.php?</span><span class=s1>&#39;</span> \
    <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>action=query</span><span class=s1>&#39;</span> \
    <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&amp;titles=File:</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span> \
    <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&amp;format=json</span><span class=s1>&#39;</span> \
    <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&amp;prop=imageinfo</span><span class=s1>&#39;</span> \
    <span class=o>+</span> <span class=sa></span><span class=s1>&#39;</span><span class=s1>&amp;iiprop=url</span><span class=s1>&#39;</span>

<span class=n>request</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
<span class=n>connection</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
<span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>connection</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=p>)</span><span class=p>)</span>

<span class=k>print</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>query</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>pages</span><span class=s1>&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popitem</span><span class=p>(</span><span class=p>)</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>imageinfo</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>[</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>url</span><span class=s1>&#39;</span><span class=p>]</span><span class=p>)</span>
</code></pre></div><p>あえて標準のライブラリでやったけど、たぶん <code>requests</code> を使ったら圧倒的に楽</p></main><p>Tags:
<a href=/tags/%E8%A8%80%E8%AA%9E%E5%87%A6%E7%90%86100%E6%9C%AC%E3%83%8E%E3%83%83%E3%82%AF>言語処理100本ノック</a>
<a href=/tags/python>Python</a></p><footer><hr>Written by Mochida Tsubasa(@tbsmcd). <a href=https://docs.google.com/forms/d/e/1FAIpQLScLrngN5Znk15zTy06N9qjO3Mi_ubIrXrX9cfYFid_2-mmbQQ/viewform>Contact</a> <a href=/index.xml>Feed</a></footer></body></html>